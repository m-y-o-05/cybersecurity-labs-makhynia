/*
 * SteganographyWindow.cpp
 *
 * –û—Å–Ω–æ–≤–Ω–∏–π —Ñ–∞–π–ª –≥–æ–ª–æ–≤–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∏ —Å—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ—ñ—ó.
 * –ú—ñ—Å—Ç–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ç–∞ –±–∞–∑–æ–≤—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é.
 */

#include "SteganographyWindow.h"
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QGridLayout>
#include <QGroupBox>
#include <QMessageBox>
#include <QFileDialog>
#include <QHeaderView>
#include <QPainter>
#include <QPixmap>
#include <QSplitter>
#include <QScrollArea>
#include <QClipboard>
#include <QApplication>

/*
 * ============================================================================
 * –ö–û–ù–°–¢–†–£–ö–¢–û–† –¢–ê –î–ï–°–¢–†–£–ö–¢–û–†
 * ============================================================================
 */

/**
 * @brief –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≥–æ–ª–æ–≤–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞.
 *
 * –í–∏–∫–æ–Ω—É—î –ø–æ–≤–Ω—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –≤—ñ–∫–Ω–∞:
 * 1. –°—Ç–≤–æ—Ä—é—î –æ–±'—î–∫—Ç –¥–≤–∏–∂–∫–∞ —Å—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ—ñ—ó.
 * 2. –ù–∞–ª–∞—à—Ç–æ–≤—É—î –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
 * 3. –ó–∞—Å—Ç–æ—Å–æ–≤—É—î —Ç–µ–º–Ω—É —Ç–µ–º—É.
 * 4. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤—ñ–∫–Ω–∞.
 *
 * @param parent –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –≤—ñ–¥–∂–µ—Ç.
 */
SteganographyWindow::SteganographyWindow(QWidget *parent)
    : QMainWindow(parent),
    stegoEngine(new SteganographyEngine())
{
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ UI.
    setupUI();

    // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Ç–µ–º–Ω—É —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è.
    applyDarkTheme();

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤—ñ–∫–Ω–∞.
    setWindowTitle("–°—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ—ñ—è - –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è—Ö");

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —ñ–∫–æ–Ω–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏.
    setWindowIcon(createProgramIcon());

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä –≤—ñ–∫–Ω–∞.
    resize(1400, 850);
}

/**
 * @brief –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä.
 *
 * –ó–≤—ñ–ª—å–Ω—è—î –≤–∏–¥—ñ–ª–µ–Ω—É –ø–∞–º'—è—Ç—å.
 */
SteganographyWindow::~SteganographyWindow() {
    // –í–∏–¥–∞–ª—è—î–º–æ –æ–±'—î–∫—Ç –¥–≤–∏–∂–∫–∞ —Å—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ—ñ—ó.
    delete stegoEngine;
}

/*
 * ============================================================================
 * –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø UI
 * ============================================================================
 */

/**
 * @brief –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.
 *
 * –°—Ç–≤–æ—Ä—é—î:
 * - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –≤—ñ–¥–∂–µ—Ç.
 * - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–∏.
 * - –í—ñ–¥–∂–µ—Ç –∑ –≤–∫–ª–∞–¥–∫–∞–º–∏ (tabs).
 * - –í—Å—ñ 4 –≤–∫–ª–∞–¥–∫–∏: –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è, –í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è, –ê–Ω–∞–ª—ñ–∑, –ê–ª–≥–æ—Ä–∏—Ç–º.
 */
void SteganographyWindow::setupUI() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –≤—ñ–¥–∂–µ—Ç.
    QWidget* centralWidget = new QWidget(this);
    setCentralWidget(centralWidget);

    // –°—Ç–≤–æ—Ä—é—î–º–æ –≥–æ–ª–æ–≤–Ω–∏–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–π layout.
    QVBoxLayout* mainLayout = new QVBoxLayout(centralWidget);
    mainLayout->setSpacing(15);
    mainLayout->setContentsMargins(20, 20, 20, 20);

    // ========== –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–∏ ==========
    QLabel* titleLabel = new QLabel(
        "–°—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ—ñ—è - –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è—Ö",
        this
        );

    // –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —à—Ä–∏—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞.
    QFont titleFont;
    titleFont.setPointSize(18);
    titleFont.setBold(true);
    titleLabel->setFont(titleFont);
    titleLabel->setAlignment(Qt::AlignCenter);

    // –°—Ç–∏–ª—ñ–∑—É—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫.
    titleLabel->setStyleSheet(
        "QLabel {"
        "   color: #00CED1;"                          // –ë—ñ—Ä—é–∑–æ–≤–∏–π –∫–æ–ª—ñ—Ä.
        "   padding: 15px;"                           // –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏.
        "   background: rgba(0, 206, 209, 0.1);"     // –ù–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π —Ñ–æ–Ω.
        "   border-radius: 10px;"                     // –ó–∞–∫—Ä—É–≥–ª–µ–Ω—ñ –∫—É—Ç–∏.
        "}"
        );

    mainLayout->addWidget(titleLabel);

    // ========== –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç–∞ –∑ –≤–∫–ª–∞–¥–∫–∞–º–∏ ==========
    tabWidget = new QTabWidget(this);

    // –î–æ–¥–∞—î–º–æ –≤—Å—ñ 4 –≤–∫–ª–∞–¥–∫–∏.
    tabWidget->addTab(createHideTab(), "–ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è");
    tabWidget->addTab(createExtractTab(), "–í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è");
    tabWidget->addTab(createAnalysisTab(), "–ê–Ω–∞–ª—ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è");
    tabWidget->addTab(createAlgorithmTab(), "–ü–æ–∫—Ä–æ–∫–æ–≤–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º");

    mainLayout->addWidget(tabWidget);
}

/*
 * ============================================================================
 * –°–¢–í–û–†–ï–ù–ù–Ø –Ü–ö–û–ù–ö–ò –ü–†–û–ì–†–ê–ú–ò
 * ============================================================================
 */

/**
 * @brief –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–∏.
 *
 * –ú–∞–ª—é—î —ñ–∫–æ–Ω–∫—É –∑ –±—ñ—Ä—é–∑–æ–≤–∏–º –≥—Ä–∞–¥—ñ—î–Ω—Ç–æ–º —Ç–∞ –µ–º–æ–¥–∑—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.
 *
 * @return –Ü–∫–æ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏.
 */
QIcon SteganographyWindow::createProgramIcon() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ pixmap 128x128 –∑ –ø—Ä–æ–∑–æ—Ä–∏–º —Ñ–æ–Ω–æ–º.
    QPixmap pixmap(128, 128);
    pixmap.fill(Qt::transparent);

    // –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è.
    QPainter painter(&pixmap);
    painter.setRenderHint(QPainter::Antialiasing);

    // ========== –ú–∞–ª—é—î–º–æ –±—ñ—Ä—é–∑–æ–≤–µ –∫–æ–ª–æ –∑ –≥—Ä–∞–¥—ñ—î–Ω—Ç–æ–º ==========
    QRadialGradient gradient(64, 64, 64);
    gradient.setColorAt(0, QColor(0, 230, 232));
    gradient.setColorAt(0.5, QColor(0, 206, 209));
    gradient.setColorAt(1, QColor(0, 153, 153));

    painter.setBrush(gradient);
    painter.setPen(Qt::NoPen);
    painter.drawEllipse(8, 8, 112, 112);

    // ========== –ú–∞–ª—é—î–º–æ –µ–º–æ–¥–∑—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è ==========
    painter.setPen(QPen(QColor("#1a1a1a"), 6));
    painter.setFont(QFont("Arial", 48, QFont::Bold));
    painter.drawText(pixmap.rect(), Qt::AlignCenter, "üñºÔ∏è");

    return QIcon(pixmap);
}

/*
 * ============================================================================
 * –î–û–ü–û–ú–Ü–ñ–ù–Ü –ú–ï–¢–û–î–ò
 * ============================================================================
 */

/**
 * @brief –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.
 *
 * –ú–∞—Å—à—Ç–∞–±—É—î —Ç–∞ –ø–æ–∫–∞–∑—É—î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –∑–∞–¥–∞–Ω—ñ–π –º—ñ—Ç—Ü—ñ.
 *
 * @param label –ú—ñ—Ç–∫–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è.
 * @param image –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –ø–æ–∫–∞–∑—É.
 * @param info –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è).
 */
void SteganographyWindow::displayImagePreview(QLabel* label,
                                              const QImage& image,
                                              const QString& info) {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö.
    if (label == nullptr || image.isNull()) {
        return;
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ QImage –≤ QPixmap.
    QPixmap pixmap = QPixmap::fromImage(image);

    // –ú–∞—Å—à—Ç–∞–±—É—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π.
    label->setPixmap(pixmap.scaled(label->size(),
                                   Qt::KeepAspectRatio,
                                   Qt::SmoothTransformation));
}
