/*
 * DigitalSignatureWindow_Slots.cpp
 *
 * –§–∞–π–ª –∑ –æ–±—Ä–æ–±–Ω–∏–∫–∞–º–∏ –ø–æ–¥—ñ–π (slots) –≥–æ–ª–æ–≤–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞.
 * –ú—ñ—Å—Ç–∏—Ç—å –≤—Å—é –ª–æ–≥—ñ–∫—É –æ–±—Ä–æ–±–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –¥—ñ–π.
 */

#include "DigitalSignatureWindow.h"
#include <QMessageBox>
#include <QFileDialog>
#include <QFile>
#include <QTextStream>
#include <QFileInfo>
#include <QClipboard>
#include <QApplication>

/*
 * ============================================================================
 * –û–ë–†–û–ë–ù–ò–ö–ò –í–ö–õ–ê–î–ö–ò –ì–ï–ù–ï–†–ê–¶–Ü–á –ö–õ–Æ–ß–Ü–í
 * ============================================================================
 */

/**
 * @brief –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–∞—Ä–∏ –∫–ª—é—á—ñ–≤ (–ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ç–∞ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ).
 *
 * –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏:
 * 1. –ó—á–∏—Ç—É—î –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –∑ –ø–æ–ª—ñ–≤ –≤–≤–µ–¥–µ–Ω–Ω—è.
 * 2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –≤—Å—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ.
 * 3. –í–∏–∫–ª–∏–∫–∞—î –¥–≤–∏–∂–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∞—Ä–∏ –∫–ª—é—á—ñ–≤.
 * 4. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∫–ª—é—á—ñ —É –≤—ñ–¥—Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
 * 5. –ü–æ–∫–∞–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö.
 *
 * –ü—Ä–æ—Ü–µ—Å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó (–≤ DigitalSignatureEngine):
 * - –û–±'—î–¥–Ω–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö: —ñ–º'—è + –ø—Ä—ñ–∑–≤–∏—â–µ + –¥–∞—Ç–∞ + —Å–µ–∫—Ä–µ—Ç.
 * - –•–µ—à—É–≤–∞–Ω–Ω—è SHA-256/SHA-512/MD5.
 * - –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á = —Ö–µ—à —É hex-—Ñ–æ—Ä–º–∞—Ç—ñ.
 * - –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á = f(–ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á) [–º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è].
 *
 * –ü—Ä–∏–∫–ª–∞–¥:
 * - –í—Ö—ñ–¥: "–Ü–≤–∞–Ω", "–ü–µ—Ç—Ä–µ–Ω–∫–æ", "15031995", "MySecret".
 * - –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á: 64 hex-—Å–∏–º–≤–æ–ª–∏ (SHA-256).
 * - –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á: (privateKey √ó multiplier) mod modulus.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–ª—é—á—ñ".
 */
void DigitalSignatureWindow::generateKeys() {
    // ========== –ö–†–û–ö 1: –ó—á–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö ==========

    // –ó—á–∏—Ç—É—î–º–æ –¥–∞–Ω—ñ –∑ –ø–æ–ª—ñ–≤ –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª—è—î–º–æ –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏.
    QString firstName = keys_firstNameEdit->text().trimmed();
    QString lastName = keys_lastNameEdit->text().trimmed();

    // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –¥–∞—Ç—É —É —Ñ–æ—Ä–º–∞—Ç ddMMyyyy (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 15031995).
    QString birthDate = keys_birthDateEdit->date().toString("ddMMyyyy");

    // –°–µ–∫—Ä–µ—Ç–Ω–µ —Å–ª–æ–≤–æ - –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ñ–∞–∫—Ç–æ—Ä –±–µ–∑–ø–µ–∫–∏.
    QString secretWord = keys_secretWordEdit->text().trimmed();

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –≤—Å—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ.
    if (firstName.isEmpty() || lastName.isEmpty() || secretWord.isEmpty()) {
        QMessageBox::warning(
            this,
            "–ü–æ–º–∏–ª–∫–∞",
            "–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!\n\n"
            "–Ü–º'—è, –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —Å–µ–∫—Ä–µ—Ç–Ω–µ —Å–ª–æ–≤–æ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º–∏."
            );
        return;  // –í–∏—Ö–æ–¥–∏–º–æ –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
    }

    // ========== –ö–†–û–ö 2: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–∞—Ä–∏ –∫–ª—é—á—ñ–≤ —á–µ—Ä–µ–∑ –¥–≤–∏–∂–æ–∫ ==========

    // –í–∏–∫–ª–∏–∫–∞—î–º–æ –º–µ—Ç–æ–¥ –¥–≤–∏–∂–∫–∞, —è–∫–∏–π:
    // 1. –û–±'—î–¥–Ω—É—î –≤—Å—ñ –¥–∞–Ω—ñ: firstName + lastName + birthDate + secretWord.
    // 2. –•–µ—à—É—î –æ–±'—î–¥–Ω–∞–Ω–∏–π —Ä—è–¥–æ–∫ –≤–∏–±—Ä–∞–Ω–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º (SHA-256/512/MD5).
    // 3. –°—Ç–≤–æ—Ä—é—î –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –∑ —Ö–µ—à—É.
    // 4. –û–±—á–∏—Å–ª—é—î –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é: (privateKey √ó mult) mod mod.
    // 5. –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É KeyPair –∑ –æ–±–æ–º–∞ –∫–ª—é—á–∞–º–∏.
    currentKeys = signatureEngine->generateKeyPair(
        firstName,
        lastName,
        birthDate,
        secretWord
        );

    // ========== –ö–†–û–ö 3: –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ ==========

    // –°—Ç–≤–æ—Ä—é—î–º–æ –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∑ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è–º–∏.
    QString privateKeyFormatted = QString(
                                      "üîí –ü–†–ò–í–ê–¢–ù–ò–ô –ö–õ–Æ–ß\n"
                                      "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n"
                                      "Hex-—Ñ–æ—Ä–º–∞—Ç:\n%1\n\n"                    // –ü—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ hex-–∫–ª—é—á.
                                      "–ß–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è:\n%2\n\n"              // –ü—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ —á–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
                                      "‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û: –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ —Ü–µ–π –∫–ª—é—á –≤ —Å–µ–∫—Ä–µ—Ç—ñ!\n"
                                      "–¢—ñ–ª—å–∫–∏ –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞.\n"
                                      "–ë—É–¥—å-—Ö—Ç–æ –∑ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –∫–ª—é—á–µ–º –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∏ –≤—ñ–¥ –≤–∞—à–æ–≥–æ —ñ–º–µ–Ω—ñ!"
                                      ).arg(currentKeys.privateKey)                // %1 - hex-—Ñ–æ—Ä–º–∞—Ç.
                                      .arg(currentKeys.privateKeyNum);            // %2 - —á–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.

    // –í–∏–≤–æ–¥–∏–º–æ —É —á–µ—Ä–≤–æ–Ω–µ –ø–æ–ª–µ (—ñ–Ω–¥–∏–∫—É—î –Ω–µ–±–µ–∑–ø–µ–∫—É/—Å–µ–∫—Ä–µ—Ç–Ω—ñ—Å—Ç—å).
    keys_privateKeyEdit->setPlainText(privateKeyFormatted);

    // ========== –ö–†–û–ö 4: –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ ==========

    // –°—Ç–≤–æ—Ä—é—î–º–æ –æ–ø–∏—Å –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –∑ —Ñ–æ—Ä–º—É–ª–æ—é –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
    QString publicKeyFormatted = QString(
                                     "üîì –ü–£–ë–õ–Ü–ß–ù–ò–ô –ö–õ–Æ–ß\n"
                                     "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n"
                                     "Hex-—Ñ–æ—Ä–º–∞—Ç:\n%1\n\n"                    // –ü—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ hex-–∫–ª—é—á.
                                     "–ß–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è:\n%2\n\n"              // –ü—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ —á–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
                                     "–§–æ—Ä–º—É–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó:\n"
                                     "publicKey = (privateKey √ó %3) mod %4\n\n"  // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É–ª—É.
                                     "–¶–µ–π –∫–ª—é—á –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —ñ–Ω—à–∏–º –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∞—à–∏—Ö –ø—ñ–¥–ø–∏—Å—ñ–≤."
                                     ).arg(currentKeys.publicKey)                 // %1 - hex-—Ñ–æ—Ä–º–∞—Ç.
                                     .arg(currentKeys.publicKeyNum)              // %2 - —á–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
                                     .arg(DigitalSignatureEngine::KEY_MULTIPLIER)  // %3 - –º–Ω–æ–∂–Ω–∏–∫.
                                     .arg(DigitalSignatureEngine::KEY_MODULUS);    // %4 - –º–æ–¥—É–ª—å.

    // –í–∏–≤–æ–¥–∏–º–æ —É –∑–µ–ª–µ–Ω–µ –ø–æ–ª–µ (—ñ–Ω–¥–∏–∫—É—î –±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ).
    keys_publicKeyEdit->setPlainText(publicKeyFormatted);

    // ========== –ö–†–û–ö 5: –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö –∑ –¥–µ—Ç–∞–ª—è–º–∏ ==========

    // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É —Ö–µ—à—É–≤–∞–Ω–Ω—è.
    QString algorithm = DigitalSignatureEngine::getAlgorithmName(
        signatureEngine->getHashAlgorithm()
        );

    QMessageBox::information(
        this,
        "–£—Å–ø—ñ—Ö",
        QString(
            "‚úÖ –ö–ª—é—á—ñ —É—Å–ø—ñ—à–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ!\n\n"
            "–ê–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à—É–≤–∞–Ω–Ω—è: %1\n\n"
            "–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á: –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç—ñ!\n"
            "–ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á: –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —ñ–Ω—à–∏–º.\n\n"
            "–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ –æ–±–∏–¥–≤–∞ –∫–ª—é—á—ñ —É —Ñ–∞–π–ª–∏."
            ).arg(algorithm)
        );
}

/**
 * @brief –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏.
 *
 * –®–≤–∏–¥–∫–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –∞–±–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.
 * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è.
 *
 * –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ:
 * - –Ü–º'—è: –Ü–≤–∞–Ω.
 * - –ü—Ä—ñ–∑–≤–∏—â–µ: –ü–µ—Ç—Ä–µ–Ω–∫–æ.
 * - –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: 15.03.1995.
 * - –°–µ–∫—Ä–µ—Ç–Ω–µ —Å–ª–æ–≤–æ: MySecretWord123.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–∫–ª–∞–¥".
 */
void DigitalSignatureWindow::fillKeysExample() {
    keys_firstNameEdit->setText("–Ü–≤–∞–Ω");
    keys_lastNameEdit->setText("–ü–µ—Ç—Ä–µ–Ω–∫–æ");
    keys_birthDateEdit->setDate(QDate(1995, 3, 15));
    keys_secretWordEdit->setText("MySecretWord123");
}

/**
 * @brief –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ —É —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª.
 *
 * –ü—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:
 * 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–≥–æ –∫–ª—é—á–∞.
 * 2. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É –º—ñ—Å—Ü—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î –¢–Ü–õ–¨–ö–ò hex-–∫–ª—é—á (–±–µ–∑ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è).
 * 4. –ü–æ–∫–∞–∑—É—î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –±–µ–∑–ø–µ–∫—É.
 *
 * –í–ê–ñ–õ–ò–í–û: –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —á–∏—Å—Ç–∏–π hex-—Ä—è–¥–æ–∫ –±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö.
 * –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É: plain text, –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞.
 *
 * –ü—Ä–∏–∫–ª–∞–¥ –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É:
 * FD3EF50CF78EAD89BF7A022F207CFBE8A4D1C9E6F0B2A7D3C5E8F1A2B4C6D8E0...
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á".
 */
void DigitalSignatureWindow::savePrivateKey() {
    // ========== –ö–†–û–ö 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∫–ª—é—á–∞ ==========

    if (currentKeys.privateKey.isEmpty()) {
        QMessageBox::warning(this, "–ü–æ–º–∏–ª–∫–∞", "–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –∫–ª—é—á—ñ!");
        return;
    }

    // ========== –ö–†–û–ö 2: –î—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É –º—ñ—Å—Ü—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è ==========

    QString fileName = QFileDialog::getSaveFileName(
        this,
        "–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á",
        "private_key.txt",
        "Text Files (*.txt);;All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // ========== –ö–†–û–ö 3: –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª—É –¥–ª—è –∑–∞–ø–∏—Å—É ==========

    QFile file(fileName);
    if (!file.open(QIODevice::WriteOnly | QIODevice::Text)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // ========== –ö–†–û–ö 4: –ó–∞–ø–∏—Å –∫–ª—é—á–∞ —É —Ñ–∞–π–ª ==========

    QTextStream out(&file);
    // –ö–†–ò–¢–ò–ß–ù–û: –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¢–Ü–õ–¨–ö–ò hex-–∫–ª—é—á –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è!
    // –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ—Ä–µ–∫—Ç–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—ñ–≤.
    out << currentKeys.privateKey;
    file.close();

    // ========== –ö–†–û–ö 5: –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –±–µ–∑–ø–µ–∫—É ==========

    QMessageBox::information(
        this,
        "–£—Å–ø—ñ—Ö",
        QString("–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É —Ñ–∞–π–ª:\n%1\n\n"
                "‚ö†Ô∏è –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ —Ü–µ–π —Ñ–∞–π–ª –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ!").arg(fileName)
        );
}

/**
 * @brief –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —É —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª.
 *
 * –ü–†–ò–ú–Ü–¢–ö–ê: –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á —è–∫ –æ—Å–Ω–æ–≤–∞!
 * –¶–µ —Å–ø—Ä–æ—â–µ–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ü—ñ–ª–µ–π.
 *
 * –£ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —Ü–∏—Ñ—Ä–æ–≤–∏—Ö –ø—ñ–¥–ø–∏—Å—ñ–≤:
 * - –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ.
 * - –ú–∞—î –≤–ª–∞—Å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, X.509).
 * - –ú–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ (–≤–ª–∞—Å–Ω–∏–∫, —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó, —Ç–æ—â–æ).
 *
 * –ü—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:
 * 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∫–ª—é—á–∞.
 * 2. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á (–¥–ª—è –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—É–±–ª—ñ—á–Ω–æ–≥–æ).
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á".
 */
void DigitalSignatureWindow::savePublicKey() {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∫–ª—é—á–∞.
    if (currentKeys.publicKey.isEmpty()) {
        QMessageBox::warning(this, "–ü–æ–º–∏–ª–∫–∞", "–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –∫–ª—é—á—ñ!");
        return;
    }

    // –î—ñ–∞–ª–æ–≥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
    QString fileName = QFileDialog::getSaveFileName(
        this,
        "–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á",
        "public_key.txt",
        "Text Files (*.txt);;All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª—É.
    QFile file(fileName);
    if (!file.open(QIODevice::WriteOnly | QIODevice::Text)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ó–∞–ø–∏—Å —É —Ñ–∞–π–ª.
    QTextStream out(&file);

    // –ü–†–ò–ú–Ü–¢–ö–ê –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á:
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á —è–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—É–±–ª—ñ—á–Ω–æ–≥–æ.
    // –¶–µ —Å–ø—Ä–æ—â–µ–Ω–Ω—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ü—ñ–ª–µ–π.
    // –£ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –º–∞—î –æ–∫—Ä–µ–º–∏–π —Ñ–æ—Ä–º–∞—Ç.
    out << currentKeys.privateKey;
    file.close();

    QMessageBox::information(
        this,
        "–£—Å–ø—ñ—Ö",
        QString("–ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É —Ñ–∞–π–ª:\n%1").arg(fileName)
        );
}

/**
 * @brief –û—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –≤–∫–ª–∞–¥–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—é—á—ñ–≤.
 *
 * –°–∫–∏–¥–∞—î –≤—Å—ñ –¥–∞–Ω—ñ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É:
 * - –û—á–∏—â–∞—î –ø–æ–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö.
 * - –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –¥–∞—Ç—É –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (01.01.2000).
 * - –û—á–∏—â–∞—î –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω—ñ –∫–ª—é—á—ñ.
 * - –°–∫–∏–¥–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É currentKeys.
 * - –î–µ–∞–∫—Ç–∏–≤—É—î –∫–Ω–æ–ø–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç–∏".
 */
void DigitalSignatureWindow::clearKeysTab() {
    // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –≤–≤–µ–¥–µ–Ω–Ω—è.
    keys_firstNameEdit->clear();
    keys_lastNameEdit->clear();
    keys_birthDateEdit->setDate(QDate(2000, 1, 1));
    keys_secretWordEdit->clear();

    // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤.
    keys_privateKeyEdit->clear();
    keys_publicKeyEdit->clear();

    // –°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∫–ª—é—á—ñ–≤ –¥–æ –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É.
    currentKeys = KeyPair();

    // –î–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–Ω–µ–º–∞—î –∫–ª—é—á—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è).
    keys_savePrivateBtn->setEnabled(false);
    keys_savePublicBtn->setEnabled(false);
}

/*
 * ============================================================================
 * –û–ë–†–û–ë–ù–ò–ö–ò –í–ö–õ–ê–î–ö–ò –°–¢–í–û–†–ï–ù–ù–Ø –ü–Ü–î–ü–ò–°–£
 * ============================================================================
 */

/**
 * @brief –í–∏–±—ñ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è.
 *
 * –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏:
 * 1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É (–±—É–¥—å-—è–∫–∏–π —Ç–∏–ø).
 * 2. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤–µ—Å—å —Ñ–∞–π–ª —É –ø–∞–º'—è—Ç—å (–±–∞–π—Ç–∏).
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î —à–ª—è—Ö —Ç–∞ –¥–∞–Ω—ñ —Ñ–∞–π–ª—É.
 * 4. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª (—ñ–º'—è, —Ä–æ–∑–º—ñ—Ä).
 * 5. –û–î–†–ê–ó–£ –æ–±—á–∏—Å–ª—é—î —Ç–∞ –ø–æ–∫–∞–∑—É—î —Ö–µ—à –¥–æ–∫—É–º–µ–Ω—Ç–∞.
 *
 * –ü—Ä–æ—Ü–µ—Å —Ö–µ—à—É–≤–∞–Ω–Ω—è:
 * - –ë–∞–π—Ç–∏ —Ñ–∞–π–ª—É ‚Üí –æ–±—Ä–∞–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (SHA-256/512/MD5)
 * - –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí hex-—Ä—è–¥–æ–∫ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ—ó –¥–æ–≤–∂–∏–Ω–∏
 * - –•–µ—à = "—Ü–∏—Ñ—Ä–æ–≤–∏–π –≤—ñ–¥–±–∏—Ç–æ–∫" –¥–æ–∫—É–º–µ–Ω—Ç–∞
 *
 * –ü—Ä–∏–∫–ª–∞–¥:
 * - –§–∞–π–ª: document.pdf (1234567 –±–∞–π—Ç).
 * - SHA-256 —Ö–µ—à: A7B2C9E4F1D8A3B5C7E9F0A2B4C6D8E0...
 * - –ù–∞–≤—ñ—Ç—å –∑–º—ñ–Ω–∞ 1 –±–∞–π—Ç–∞ ‚Üí –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω—à–∏–π —Ö–µ—à!
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–í–∏–±—Ä–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç"
 * –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É.
 */
void DigitalSignatureWindow::selectDocumentToSign() {
    // ========== –ö–†–û–ö 1: –î—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É ==========

    QString fileName = QFileDialog::getOpenFileName(
        this,
        "–í–∏–±–µ—Ä—ñ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è",
        "",
        "All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // ========== –ö–†–û–ö 2: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É ==========

    QFile file(fileName);
    // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —É –ë–Ü–ù–ê–†–ù–û–ú–£ —Ä–µ–∂–∏–º—ñ (–±–µ–∑ Text) –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ –±—É–¥—å-—è–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.
    if (!file.open(QIODevice::ReadOnly)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ß–∏—Ç–∞—î–º–æ –≤–µ—Å—å —Ñ–∞–π–ª —É –ø–∞–º'—è—Ç—å.
    // –£–í–ê–ì–ê: –î–ª—è –¥—É–∂–µ –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ (>100 –ú–ë) –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω–æ.
    signDocumentData = file.readAll();
    file.close();

    // ========== –ö–†–û–ö 3: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö ==========

    signDocumentPath = fileName;
    sign_documentPathEdit->setText(fileName);

    // ========== –ö–†–û–ö 4: –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ñ–∞–π–ª ==========

    QFileInfo fileInfo(fileName);
    sign_documentInfoLabel->setText(
        QString("%1 (%2 –±–∞–π—Ç)")
            .arg(fileInfo.fileName())
            .arg(signDocumentData.size())
        );

    // ========== –ö–†–û–ö 5: –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ö–µ—à—É ==========

    // –û–±—á–∏—Å–ª—é—î–º–æ —Ö–µ—à –¥–æ–∫—É–º–µ–Ω—Ç–∞ (SHA-256/512/MD5 –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è).
    QString hash = signatureEngine->calculateHash(signDocumentData);

    // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É.
    QString algorithm = DigitalSignatureEngine::getAlgorithmName(
        signatureEngine->getHashAlgorithm()
        );

    // –í–∏–≤–æ–¥–∏–º–æ —É —Ñ—ñ–æ–ª–µ—Ç–æ–≤–µ –ø–æ–ª–µ (—Ö–µ—à –¥–æ–∫—É–º–µ–Ω—Ç–∞).
    sign_documentHashEdit->setPlainText(
        QString("–ê–ª–≥–æ—Ä–∏—Ç–º: %1\n\n–•–µ—à:\n%2").arg(algorithm).arg(hash)
        );

    // –ù–∞–ª–∞–≥–æ–¥–∂—É–≤–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è.
    qDebug() << "Document selected:" << fileName;
    qDebug() << "File size:" << signDocumentData.size() << "bytes";
    qDebug() << "Hash:" << hash;
}

/**
 * @brief –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∑ —Ñ–∞–π–ª—É.
 *
 * –ü—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
 * 1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É –∫–ª—é—á–∞.
 * 2. –ß–∏—Ç–∞—î –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É (hex-—Ä—è–¥–æ–∫).
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î –∫–ª—é—á —É –∑–º—ñ–Ω–Ω—É loadedPrivateKey.
 * 4. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É.
 *
 * –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É: plain text –∑ hex-–∫–ª—é—á–µ–º (64 —Å–∏–º–≤–æ–ª–∏ –¥–ª—è SHA-256).
 * –ü—Ä–∏–∫–ª–∞–¥: FD3EF50CF78EAD89BF7A022F207CFBE8...
 *
 * –í–ê–ñ–õ–ò–í–û: –¶–µ –º–∞—î –±—É—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ 1!
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á".
 */
void DigitalSignatureWindow::loadPrivateKey() {
    // –î—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É.
    QString fileName = QFileDialog::getOpenFileName(
        this,
        "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á",
        "",
        "Text Files (*.txt);;All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª—É.
    QFile file(fileName);
    if (!file.open(QIODevice::ReadOnly | QIODevice::Text)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ß–∏—Ç–∞–Ω–Ω—è –∫–ª—é—á–∞ (–æ—á—ñ–∫—É—î–º–æ hex-—Ä—è–¥–æ–∫).
    QTextStream in(&file);
    loadedPrivateKey = in.readAll().trimmed();
    file.close();

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à–ª—è—Ö—É.
    sign_privateKeyPathEdit->setText(fileName);

    // –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.
    qDebug() << "Private key loaded from:" << fileName;
    qDebug() << "Key:" << loadedPrivateKey;
}

/**
 * @brief –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É –¥–æ–∫—É–º–µ–Ω—Ç–∞.
 *
 * –ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É:
 * 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞.
 * 2. –í–∏–∫–ª–∏–∫–∞—î –¥–≤–∏–∂–æ–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É.
 * 3. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø—ñ–¥–ø–∏—Å.
 * 4. –ê–∫—Ç–∏–≤—É—î –∫–Ω–æ–ø–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
 *
 * –ü—Ä–æ—Ü–µ—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É (–≤ DigitalSignatureEngine):
 * 1. –•–µ—à—É–≤–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Üí documentHash.
 * 2. "–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è" —Ö–µ—à—É –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –∫–ª—é—á–µ–º ‚Üí signature.
 *    (–ù–∞—Å–ø—Ä–∞–≤–¥—ñ —Ü–µ XOR –∞–±–æ —ñ–Ω—à–∞ –ø—Ä–æ—Å—Ç–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó).
 * 3. –†–µ–∑—É–ª—å—Ç–∞—Ç = —Ü–∏—Ñ—Ä–æ–≤–∏–π –ø—ñ–¥–ø–∏—Å (hex-—Ä—è–¥–æ–∫).
 *
 * –ü—Ä–∏–∫–ª–∞–¥:
 * - –î–æ–∫—É–º–µ–Ω—Ç ‚Üí SHA-256 ‚Üí A7B2C9E4F1D8A3B5...
 * - A7B2C9E4... XOR –ø—Ä–∏–≤–∞—Ç–Ω–∏–π_–∫–ª—é—á ‚Üí –ø—ñ–¥–ø–∏—Å.
 * - –ü—ñ–¥–ø–∏—Å –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–º –∫–ª—é—á–µ–º.
 *
 * –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞:
 * - signature = encrypt(hash, privateKey).
 * - hash = decrypt(signature, publicKey).
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å".
 */
void DigitalSignatureWindow::createSignature() {
    // ========== –ö–†–û–ö 1: –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö ==========

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
    if (signDocumentData.isEmpty()) {
        QMessageBox::warning(this, "–ü–æ–º–∏–ª–∫–∞", "–°–ø–æ—á–∞—Ç–∫—É –≤–∏–±–µ—Ä—ñ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç!");
        return;
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞.
    if (loadedPrivateKey.isEmpty()) {
        QMessageBox::warning(
            this,
            "–ü–æ–º–∏–ª–∫–∞",
            "–°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á!"
            );
        return;
    }

    // ========== –ö–†–û–ö 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É —á–µ—Ä–µ–∑ –¥–≤–∏–∂–æ–∫ ==========

    // –î–≤–∏–∂–æ–∫ –≤–∏–∫–æ–Ω—É—î:
    // 1. –û–±—á–∏—Å–ª—é—î —Ö–µ—à –¥–æ–∫—É–º–µ–Ω—Ç–∞.
    // 2. "–®–∏—Ñ—Ä—É—î" —Ö–µ—à –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –∫–ª—é—á–µ–º (XOR –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó).
    // 3. –ö–æ–Ω–≤–µ—Ä—Ç—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É hex-—Ñ–æ—Ä–º–∞—Ç.
    // 4. –ü–æ–≤–µ—Ä—Ç–∞—î –ø—ñ–¥–ø–∏—Å —è–∫ QString.
    createdSignature = signatureEngine->createSignature(
        signDocumentData,
        loadedPrivateKey
        );

    // ========== –ö–†–û–ö 3: –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É ==========

    // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–≤—É –∞–ª–≥–æ—Ä–∏—Ç–º—É.
    QString algorithm = DigitalSignatureEngine::getAlgorithmName(
        signatureEngine->getHashAlgorithm()
        );

    // –í–∏–≤–æ–¥–∏–º–æ —É –∑–µ–ª–µ–Ω–µ –ø–æ–ª–µ (–ø—ñ–¥–ø–∏—Å).
    sign_signatureEdit->setPlainText(
        QString(
            "–ê–ª–≥–æ—Ä–∏—Ç–º: %1\n\n"
            "–¶–∏—Ñ—Ä–æ–≤–∏–π –ø—ñ–¥–ø–∏—Å:\n%2\n\n"
            "–¶–µ–π –ø—ñ–¥–ø–∏—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –∞–≤—Ç–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞."
            ).arg(algorithm).arg(createdSignature)
        );

    // ========== –ö–†–û–ö 4: –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö ==========

    QMessageBox::information(
        this,
        "–£—Å–ø—ñ—Ö",
        "‚úÖ –¶–∏—Ñ—Ä–æ–≤–∏–π –ø—ñ–¥–ø–∏—Å —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ!\n\n"
        "–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –∑–±–µ—Ä–µ–≥—Ç–∏ –ø—ñ–¥–ø–∏—Å —É —Ñ–∞–π–ª —ñ –ø–µ—Ä–µ–¥–∞—Ç–∏ –π–æ–≥–æ "
        "—Ä–∞–∑–æ–º –∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏."
        );

    // –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.
    qDebug() << "Signature created:" << createdSignature;
}

/**
 * @brief –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É —É —Ñ–∞–π–ª.
 *
 * –ü—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:
 * 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É.
 * 2. –ü—Ä–æ–ø–æ–Ω—É—î –∑–±–µ—Ä–µ–≥—Ç–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º .sig.
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î hex-—Ä—è–¥–æ–∫ –ø—ñ–¥–ø–∏—Å—É.
 *
 * –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É: plain text –∑ hex-–ø—ñ–¥–ø–∏—Å–æ–º.
 * –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è: .sig (signature) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–∏—Ö –ø—ñ–¥–ø–∏—Å—ñ–≤.
 *
 * –ü—Ä–∏–∫–ª–∞–¥ –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É:
 * B8A3C5E7D9F1A2B4C6D8E0F2A4B6C8D0E2F4A6B8C0D2E4F6A8B0C2D4E6F8A0B2...
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—ñ–¥–ø–∏—Å".
 */
void DigitalSignatureWindow::saveSignature() {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –ø—ñ–¥–ø–∏—Å—É.
    if (createdSignature.isEmpty()) {
        QMessageBox::warning(this, "–ü–æ–º–∏–ª–∫–∞", "–°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø—ñ–¥–ø–∏—Å!");
        return;
    }

    // –î—ñ–∞–ª–æ–≥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
    QString fileName = QFileDialog::getSaveFileName(
        this,
        "–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—ñ–¥–ø–∏—Å",
        "signature.sig",
        "Signature Files (*.sig);;Text Files (*.txt);;All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª—É.
    QFile file(fileName);
    if (!file.open(QIODevice::WriteOnly | QIODevice::Text)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ó–∞–ø–∏—Å –ø—ñ–¥–ø–∏—Å—É (—Ç—ñ–ª—å–∫–∏ hex-—Ä—è–¥–æ–∫).
    QTextStream out(&file);
    out << createdSignature;
    file.close();

    QMessageBox::information(
        this,
        "–£—Å–ø—ñ—Ö",
        QString("–ü—ñ–¥–ø–∏—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É —Ñ–∞–π–ª:\n%1").arg(fileName)
        );
}

/**
 * @brief –û—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –≤–∫–ª–∞–¥–∫–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É.
 *
 * –°–∫–∏–¥–∞—î –≤—Å—ñ –¥–∞–Ω—ñ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É:
 * - –û—á–∏—â—É—î —à–ª—è—Ö–∏ –¥–æ —Ñ–∞–π–ª—ñ–≤.
 * - –û—á–∏—â–∞—î —Ö–µ—à —Ç–∞ –ø—ñ–¥–ø–∏—Å.
 * - –í–∏–¥–∞–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ –∑ –ø–∞–º'—è—Ç—ñ.
 * - –î–µ–∞–∫—Ç–∏–≤—É—î –∫–Ω–æ–ø–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç–∏".
 */
void DigitalSignatureWindow::clearSignTab() {
    // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ UI.
    sign_documentPathEdit->clear();
    sign_privateKeyPathEdit->clear();
    sign_documentHashEdit->clear();
    sign_signatureEdit->clear();
    sign_documentInfoLabel->clear();

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –ø–∞–º'—è—Ç—ñ.
    signDocumentPath.clear();
    signDocumentData.clear();
    loadedPrivateKey.clear();
    createdSignature.clear();

    // –î–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
    sign_saveBtn->setEnabled(false);
}

/*
 * ============================================================================
 * –û–ë–†–û–ë–ù–ò–ö–ò –í–ö–õ–ê–î–ö–ò –ü–ï–†–ï–í–Ü–†–ö–ò –ü–Ü–î–ü–ò–°–£
 * ============================================================================
 */

/**
 * @brief –í–∏–±—ñ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É.
 *
 * –ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û: –¶–µ –º–∞—î –±—É—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π –¥–æ–∫—É–º–µ–Ω—Ç, —â–æ –±—É–≤ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π!
 * –ù–∞–≤—ñ—Ç—å –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–∞ (1 –±–∞–π—Ç) –∑—Ä–æ–±–∏—Ç—å –ø—ñ–¥–ø–∏—Å –Ω–µ–¥—ñ–π—Å–Ω–∏–º.
 *
 * –ü—Ä–æ—Ü–µ—Å:
 * 1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É.
 * 2. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ñ–∞–π–ª —É –ø–∞–º'—è—Ç—å.
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î –¥–∞–Ω—ñ —Ç–∞ —à–ª—è—Ö.
 * 4. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª.
 *
 * –ü—Ä–∏–º—ñ—Ç–∫–∞: –•–µ—à –ù–ï –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è —Ç—É—Ç, –∞ —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏,
 * —â–æ–± –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∑ —Ö–µ—à–µ–º –∑ –ø—ñ–¥–ø–∏—Å—É.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–í–∏–±—Ä–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç"
 * –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
 */
void DigitalSignatureWindow::selectDocumentToVerify() {
    // –î—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É.
    QString fileName = QFileDialog::getOpenFileName(
        this,
        "–í–∏–±–µ—Ä—ñ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏",
        "",
        "All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É.
    QFile file(fileName);
    if (!file.open(QIODevice::ReadOnly)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ß–∏—Ç–∞–Ω–Ω—è –±–∞–π—Ç—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
    verifyDocumentData = file.readAll();
    file.close();

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö.
    verifyDocumentPath = fileName;
    verify_documentPathEdit->setText(fileName);

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ñ–∞–π–ª.
    QFileInfo fileInfo(fileName);
    verify_documentInfoLabel->setText(
        QString("%1 (%2 –±–∞–π—Ç)")
            .arg(fileInfo.fileName())
            .arg(verifyDocumentData.size())
        );

    // –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.
    qDebug() << "Verification document selected:" << fileName;
    qDebug() << "File size:" << verifyDocumentData.size() << "bytes";
}

/**
 * @brief –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É –ø—ñ–¥–ø–∏—Å—É (.sig).
 *
 * –ü—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
 * 1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É –ø—ñ–¥–ø–∏—Å—É.
 * 2. –ß–∏—Ç–∞—î hex-—Ä—è–¥–æ–∫ –ø—ñ–¥–ø–∏—Å—É.
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î —É –∑–º—ñ–Ω–Ω—É loadedSignature.
 *
 * –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É: plain text –∑ hex-–ø—ñ–¥–ø–∏—Å–æ–º.
 * –ü—Ä–∏–∫–ª–∞–¥: B8A3C5E7D9F1A2B4C6D8E0F2A4B6C8D0...
 *
 * –í–ê–ñ–õ–ò–í–û: –¶–µ –ø—ñ–¥–ø–∏—Å, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ 2 –¥–ª—è —Ü—å–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞!
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å".
 */
void DigitalSignatureWindow::loadSignature() {
    // –î—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É (–∑ —Ñ—ñ–ª—å—Ç—Ä–æ–º .sig).
    QString fileName = QFileDialog::getOpenFileName(
        this,
        "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å",
        "",
        "Signature Files (*.sig);;Text Files (*.txt);;All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª—É.
    QFile file(fileName);
    if (!file.open(QIODevice::ReadOnly | QIODevice::Text)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ß–∏—Ç–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É.
    QTextStream in(&file);
    loadedSignature = in.readAll().trimmed();
    file.close();

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à–ª—è—Ö—É.
    verify_signaturePathEdit->setText(fileName);

    // –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.
    qDebug() << "Signature loaded from:" << fileName;
    qDebug() << "Signature:" << loadedSignature;
}

/**
 * @brief –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –∞–≤—Ç–æ—Ä–∞ –ø—ñ–¥–ø–∏—Å—É.
 *
 * –í–ê–ñ–õ–ò–í–û: –ü–æ—Ç—Ä—ñ–±–µ–Ω –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –∞–≤—Ç–æ—Ä–∞, –ù–ï –ø—Ä–∏–≤–∞—Ç–Ω–∏–π!
 * –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è "—Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è" –ø—ñ–¥–ø–∏—Å—É
 * —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ.
 *
 * –ü—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
 * 1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—É.
 * 2. –ß–∏—Ç–∞—î hex-—Ä—è–¥–æ–∫ –∫–ª—é—á–∞.
 * 3. –ó–±–µ—Ä—ñ–≥–∞—î —É loadedPublicKey.
 *
 * –ü—Ä–∏–º—ñ—Ç–∫–∞: –£ –Ω–∞—à—ñ–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á,
 * –∑ —è–∫–æ–≥–æ —Ä–µ–≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø—É–±–ª—ñ—á–Ω–∏–π. –¶–µ —Å–ø—Ä–æ—â–µ–Ω–Ω—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á".
 */
void DigitalSignatureWindow::loadPublicKey() {
    // –î—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É.
    QString fileName = QFileDialog::getOpenFileName(
        this,
        "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á",
        "",
        "Text Files (*.txt);;All Files (*)"
        );

    if (fileName.isEmpty()) {
        return;
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª—É.
    QFile file(fileName);
    if (!file.open(QIODevice::ReadOnly | QIODevice::Text)) {
        QMessageBox::critical(this, "–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª!");
        return;
    }

    // –ß–∏—Ç–∞–Ω–Ω—è –∫–ª—é—á–∞.
    QTextStream in(&file);
    loadedPublicKey = in.readAll().trimmed();
    file.close();

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à–ª—è—Ö—É.
    verify_publicKeyPathEdit->setText(fileName);

    // –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.
    qDebug() << "Public key loaded from:" << fileName;
    qDebug() << "Key:" << loadedPublicKey;
}

/**
 * @brief –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É –¥–æ–∫—É–º–µ–Ω—Ç–∞.
 *
 * –ê–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:
 * 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —É—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (–¥–æ–∫—É–º–µ–Ω—Ç, –ø—ñ–¥–ø–∏—Å, –∫–ª—é—á).
 * 2. –í–∏–∫–ª–∏–∫–∞—î –¥–≤–∏–∂–æ–∫ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É.
 * 3. –û—Ç—Ä–∏–º—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É SignatureResult –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
 * 4. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
 *
 * –ü—Ä–æ—Ü–µ—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (–≤ DigitalSignatureEngine):
 * 1. –û–±—á–∏—Å–ª—é—î–º–æ —Ö–µ—à –ø–æ—Ç–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Üí currentHash.
 * 2. "–†–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î–º–æ" –ø—ñ–¥–ø–∏—Å –ø—É–±–ª—ñ—á–Ω–∏–º –∫–ª—é—á–µ–º ‚Üí originalHash.
 * 3. –ü–æ—Ä—ñ–≤–Ω—é—î–º–æ —Ö–µ—à—ñ: currentHash == originalHash?.
 *    - –¢–ê–ö ‚Üí –ø—ñ–¥–ø–∏—Å –î–Ü–ô–°–ù–ò–ô ‚úÖ (–¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –∑–º—ñ–Ω—é–≤–∞–≤—Å—è).
 *    - –ù–Ü ‚Üí –ø—ñ–¥–ø–∏—Å –ù–ï–î–Ü–ô–°–ù–ò–ô ‚ùå (–¥–æ–∫—É–º–µ–Ω—Ç –∑–º—ñ–Ω–∏–ª–∏ –∞–±–æ –ø—ñ–¥—Ä–æ–±–∫–∞).
 *
 * –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞:
 * - signature = encrypt(hash, privateKey)     ‚Üê —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.
 * - hash = decrypt(signature, publicKey)      ‚Üê –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞.
 * - –Ø–∫—â–æ hash == currentHash ‚Üí –∞–≤—Ç–µ–Ω—Ç–∏—á–Ω–∏–π!
 *
 * –ü—Ä–∏–∫–ª–∞–¥ –î–Ü–ô–°–ù–û–ì–û –ø—ñ–¥–ø–∏—Å—É:
 * - –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Ö–µ—à: A7B2C9E4...
 * - –ü–æ—Ç–æ—á–Ω–∏–π —Ö–µ—à:     A7B2C9E4...  ‚Üê –ó–ë–Ü–ì–ê–Æ–¢–¨–°–Ø! ‚úÖ
 *
 * –ü—Ä–∏–∫–ª–∞–¥ –ù–ï–î–Ü–ô–°–ù–û–ì–û –ø—ñ–¥–ø–∏—Å—É:
 * - –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Ö–µ—à: A7B2C9E4...
 * - –ü–æ—Ç–æ—á–Ω–∏–π —Ö–µ—à:     B8C3D0E5...  ‚Üê –†–Ü–ó–ù–Ü! ‚ùå
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å".
 */
void DigitalSignatureWindow::verifySignature() {
    // ========== –ö–†–û–ö 1: –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö ==========

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
    if (verifyDocumentData.isEmpty()) {
        QMessageBox::warning(this, "–ü–æ–º–∏–ª–∫–∞", "–°–ø–æ—á–∞—Ç–∫—É –≤–∏–±–µ—Ä—ñ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç!");
        return;
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É.
    if (loadedSignature.isEmpty()) {
        QMessageBox::warning(this, "–ü–æ–º–∏–ª–∫–∞", "–°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—ñ–¥–ø–∏—Å!");
        return;
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞.
    if (loadedPublicKey.isEmpty()) {
        QMessageBox::warning(
            this,
            "–ü–æ–º–∏–ª–∫–∞",
            "–°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á!"
            );
        return;
    }

    // ========== –ö–†–û–ö 2: –í–∏–∫–ª–∏–∫ –¥–≤–∏–∂–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ ==========

    // –î–≤–∏–∂–æ–∫ –≤–∏–∫–æ–Ω—É—î:
    // 1. –•–µ—à—É–≤–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
    // 2. "–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è" –ø—ñ–¥–ø–∏—Å—É –ø—É–±–ª—ñ—á–Ω–∏–º –∫–ª—é—á–µ–º.
    // 3. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ö–µ—à—ñ–≤.
    // 4. –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É SignatureResult –∑ —É—Å—ñ–º–∞ –¥–µ—Ç–∞–ª—è–º–∏.
    SignatureResult result = signatureEngine->verifySignature(
        verifyDocumentData,    // –ë–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
        loadedSignature,       // –ü—ñ–¥–ø–∏—Å (hex).
        loadedPublicKey        // –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á (hex).
        );

    // ========== –ö–†–û–ö 3: –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É ==========

    // –ú–µ—Ç–æ–¥ displayVerificationResult() —Ñ–æ—Ä–º–∞—Ç—É—î —Ç–∞ –≤–∏–≤–æ–¥–∏—Ç—å:
    // - ‚úÖ –î–Ü–ô–°–ù–ò–ô –∞–±–æ ‚ùå –ù–ï–î–Ü–ô–°–ù–ò–ô.
    // - –î–µ—Ç–∞–ª—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–∞ –ø–æ—Ç–æ—á–Ω–∏–π —Ö–µ—à—ñ).
    // - –¢–µ—Ö–Ω—ñ—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∞–ª–≥–æ—Ä–∏—Ç–º.
    displayVerificationResult(result);

    // –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
    qDebug() << "Verification result:" << (result.isValid ? "VALID" : "INVALID");
}

/**
 * @brief –û—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –≤–∫–ª–∞–¥–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É.
 *
 * –°–∫–∏–¥–∞—î –≤—Å—ñ –¥–∞–Ω—ñ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É:
 * - –û—á–∏—â—É—î —à–ª—è—Ö–∏ –¥–æ —Ñ–∞–π–ª—ñ–≤.
 * - –û—á–∏—â—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–∞ –¥–µ—Ç–∞–ª—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
 * - –í–∏–¥–∞–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ –∑ –ø–∞–º'—è—Ç—ñ.
 * - –ü—Ä–∏—Ö–æ–≤—É—î –ø–∞–Ω–µ–ª—å –¥–µ—Ç–∞–ª–µ–π.
 *
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç–∏".
 */
void DigitalSignatureWindow::clearVerifyTab() {
    // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ UI.
    verify_documentPathEdit->clear();
    verify_signaturePathEdit->clear();
    verify_publicKeyPathEdit->clear();
    verify_resultEdit->clear();
    verify_documentInfoLabel->clear();

    // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –¥–µ—Ç–∞–ª–µ–π.
    verify_originalHashEdit->clear();
    verify_currentHashEdit->clear();
    verify_decryptedHashEdit->clear();

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –ø–∞–º'—è—Ç—ñ.
    verifyDocumentPath.clear();
    verifyDocumentData.clear();
    loadedSignature.clear();
    loadedPublicKey.clear();

    // –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–∞–Ω–µ–ª—ñ –¥–µ—Ç–∞–ª–µ–π.
    verify_detailsGroup->setVisible(false);
}
